{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 2,
  "links": [],
  "panels": [
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "eemqg1029gbnka"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "target_population"
            },
            "properties": [
              {
                "id": "unit",
                "value": "locale"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 16,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 7,
      "options": {
        "nestedObjects": [],
        "tables": [
          {
            "actionsColumnConfig": {
              "alignment": "start",
              "fontSize": "md",
              "label": "",
              "width": {
                "auto": false,
                "value": 100
              }
            },
            "addRow": {
              "enabled": false,
              "permission": {
                "mode": "",
                "userRole": []
              },
              "request": {
                "datasource": "",
                "payload": {}
              }
            },
            "deleteRow": {
              "enabled": false,
              "permission": {
                "mode": "",
                "userRole": []
              },
              "request": {
                "datasource": "",
                "payload": {}
              }
            },
            "expanded": true,
            "items": [
              {
                "aggregation": "none",
                "appearance": {
                  "alignment": "start",
                  "background": {
                    "applyToRow": false
                  },
                  "colors": {},
                  "header": {
                    "fontSize": "md"
                  },
                  "width": {
                    "auto": true,
                    "min": 20,
                    "value": 100
                  },
                  "wrap": true
                },
                "columnTooltip": "",
                "edit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false,
                  "permission": {
                    "mode": "",
                    "userRole": []
                  }
                },
                "enabled": true,
                "field": {
                  "name": "vector_system",
                  "source": "A"
                },
                "fileCell": {
                  "size": "md",
                  "text": "Download",
                  "variant": "primary"
                },
                "filter": {
                  "enabled": false,
                  "mode": "client",
                  "variable": ""
                },
                "footer": [],
                "gauge": {
                  "mode": "basic",
                  "valueDisplayMode": "text",
                  "valueSize": 14
                },
                "group": false,
                "label": "",
                "newRowEdit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false
                },
                "objectId": "",
                "pin": "",
                "preformattedStyle": false,
                "scale": "auto",
                "showingRows": 20,
                "sort": {
                  "descFirst": false,
                  "enabled": true
                },
                "type": "auto"
              },
              {
                "aggregation": "none",
                "appearance": {
                  "alignment": "start",
                  "background": {
                    "applyToRow": false
                  },
                  "colors": {},
                  "header": {
                    "fontSize": "md"
                  },
                  "width": {
                    "auto": true,
                    "min": 20,
                    "value": 100
                  },
                  "wrap": true
                },
                "columnTooltip": "",
                "edit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false,
                  "permission": {
                    "mode": "",
                    "userRole": []
                  }
                },
                "enabled": true,
                "field": {
                  "name": "target_unoccupied_system",
                  "source": "A"
                },
                "fileCell": {
                  "size": "md",
                  "text": "Download",
                  "variant": "primary"
                },
                "filter": {
                  "enabled": false,
                  "mode": "client",
                  "variable": ""
                },
                "footer": [],
                "gauge": {
                  "mode": "basic",
                  "valueDisplayMode": "text",
                  "valueSize": 14
                },
                "group": false,
                "label": "",
                "newRowEdit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false
                },
                "objectId": "",
                "pin": "",
                "preformattedStyle": false,
                "scale": "auto",
                "showingRows": 20,
                "sort": {
                  "descFirst": false,
                  "enabled": true
                },
                "type": "auto"
              },
              {
                "aggregation": "none",
                "appearance": {
                  "alignment": "start",
                  "background": {
                    "applyToRow": false
                  },
                  "colors": {},
                  "header": {
                    "fontSize": "md"
                  },
                  "width": {
                    "auto": true,
                    "min": 20,
                    "value": 100
                  },
                  "wrap": true
                },
                "columnTooltip": "",
                "edit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false,
                  "permission": {
                    "mode": "",
                    "userRole": []
                  }
                },
                "enabled": true,
                "field": {
                  "name": "mineables",
                  "source": "A"
                },
                "fileCell": {
                  "size": "md",
                  "text": "Download",
                  "variant": "primary"
                },
                "filter": {
                  "enabled": false,
                  "mode": "client",
                  "variable": ""
                },
                "footer": [],
                "gauge": {
                  "mode": "basic",
                  "valueDisplayMode": "text",
                  "valueSize": 14
                },
                "group": false,
                "label": "",
                "newRowEdit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false
                },
                "objectId": "",
                "pin": "",
                "preformattedStyle": false,
                "scale": "auto",
                "showingRows": 20,
                "sort": {
                  "descFirst": false,
                  "enabled": false
                },
                "type": "auto"
              },
              {
                "aggregation": "none",
                "appearance": {
                  "alignment": "start",
                  "background": {
                    "applyToRow": false
                  },
                  "colors": {},
                  "header": {
                    "fontSize": "md"
                  },
                  "width": {
                    "auto": true,
                    "min": 20,
                    "value": 100
                  },
                  "wrap": true
                },
                "columnTooltip": "",
                "edit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false,
                  "permission": {
                    "mode": "",
                    "userRole": []
                  }
                },
                "enabled": true,
                "field": {
                  "name": "distance",
                  "source": "A"
                },
                "fileCell": {
                  "size": "md",
                  "text": "Download",
                  "variant": "primary"
                },
                "filter": {
                  "enabled": false,
                  "mode": "client",
                  "variable": ""
                },
                "footer": [],
                "gauge": {
                  "mode": "basic",
                  "valueDisplayMode": "text",
                  "valueSize": 14
                },
                "group": false,
                "label": "",
                "newRowEdit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false
                },
                "objectId": "",
                "pin": "",
                "preformattedStyle": false,
                "scale": "auto",
                "showingRows": 20,
                "sort": {
                  "descFirst": false,
                  "enabled": false
                },
                "type": "auto"
              },
              {
                "aggregation": "none",
                "appearance": {
                  "alignment": "start",
                  "background": {
                    "applyToRow": false
                  },
                  "colors": {},
                  "header": {
                    "fontSize": "md"
                  },
                  "width": {
                    "auto": true,
                    "min": 20,
                    "value": 100
                  },
                  "wrap": true
                },
                "columnTooltip": "",
                "edit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false,
                  "permission": {
                    "mode": "",
                    "userRole": []
                  }
                },
                "enabled": true,
                "field": {
                  "name": "target_population",
                  "source": "A"
                },
                "fileCell": {
                  "size": "md",
                  "text": "Download",
                  "variant": "primary"
                },
                "filter": {
                  "enabled": false,
                  "mode": "client",
                  "variable": ""
                },
                "footer": [],
                "gauge": {
                  "mode": "basic",
                  "valueDisplayMode": "text",
                  "valueSize": 14
                },
                "group": false,
                "label": "",
                "newRowEdit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false
                },
                "objectId": "",
                "pin": "",
                "preformattedStyle": false,
                "scale": "auto",
                "showingRows": 20,
                "sort": {
                  "descFirst": false,
                  "enabled": true
                },
                "type": "auto"
              },
              {
                "aggregation": "none",
                "appearance": {
                  "alignment": "start",
                  "background": {
                    "applyToRow": false
                  },
                  "colors": {},
                  "header": {
                    "fontSize": "md"
                  },
                  "width": {
                    "auto": true,
                    "min": 20,
                    "value": 100
                  },
                  "wrap": true
                },
                "columnTooltip": "",
                "edit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false,
                  "permission": {
                    "mode": "",
                    "userRole": []
                  }
                },
                "enabled": true,
                "field": {
                  "name": "target_body_count",
                  "source": "A"
                },
                "fileCell": {
                  "size": "md",
                  "text": "Download",
                  "variant": "primary"
                },
                "filter": {
                  "enabled": false,
                  "mode": "client",
                  "variable": ""
                },
                "footer": [],
                "gauge": {
                  "mode": "basic",
                  "valueDisplayMode": "text",
                  "valueSize": 14
                },
                "group": false,
                "label": "",
                "newRowEdit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false
                },
                "objectId": "",
                "pin": "",
                "preformattedStyle": false,
                "scale": "auto",
                "showingRows": 20,
                "sort": {
                  "descFirst": false,
                  "enabled": false
                },
                "type": "auto"
              },
              {
                "aggregation": "none",
                "appearance": {
                  "alignment": "start",
                  "background": {
                    "applyToRow": false
                  },
                  "colors": {},
                  "header": {
                    "fontSize": "md"
                  },
                  "width": {
                    "auto": true,
                    "min": 20,
                    "value": 100
                  },
                  "wrap": true
                },
                "columnTooltip": "",
                "edit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false,
                  "permission": {
                    "mode": "",
                    "userRole": []
                  }
                },
                "enabled": true,
                "field": {
                  "name": "target_controlling_faction_state",
                  "source": "A"
                },
                "fileCell": {
                  "size": "md",
                  "text": "Download",
                  "variant": "primary"
                },
                "filter": {
                  "enabled": false,
                  "mode": "client",
                  "variable": ""
                },
                "footer": [],
                "gauge": {
                  "mode": "basic",
                  "valueDisplayMode": "text",
                  "valueSize": 14
                },
                "group": false,
                "label": "",
                "newRowEdit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false
                },
                "objectId": "",
                "pin": "",
                "preformattedStyle": false,
                "scale": "auto",
                "showingRows": 20,
                "sort": {
                  "descFirst": false,
                  "enabled": true
                },
                "type": "auto"
              },
              {
                "aggregation": "none",
                "appearance": {
                  "alignment": "start",
                  "background": {
                    "applyToRow": false
                  },
                  "colors": {},
                  "header": {
                    "fontSize": "md"
                  },
                  "width": {
                    "auto": true,
                    "min": 20,
                    "value": 100
                  },
                  "wrap": true
                },
                "columnTooltip": "",
                "edit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false,
                  "permission": {
                    "mode": "",
                    "userRole": []
                  }
                },
                "enabled": true,
                "field": {
                  "name": "target_primary_economy",
                  "source": "A"
                },
                "fileCell": {
                  "size": "md",
                  "text": "Download",
                  "variant": "primary"
                },
                "filter": {
                  "enabled": false,
                  "mode": "client",
                  "variable": ""
                },
                "footer": [],
                "gauge": {
                  "mode": "basic",
                  "valueDisplayMode": "text",
                  "valueSize": 14
                },
                "group": false,
                "label": "",
                "newRowEdit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false
                },
                "objectId": "",
                "pin": "",
                "preformattedStyle": false,
                "scale": "auto",
                "showingRows": 20,
                "sort": {
                  "descFirst": false,
                  "enabled": true
                },
                "type": "auto"
              },
              {
                "aggregation": "none",
                "appearance": {
                  "alignment": "start",
                  "background": {
                    "applyToRow": false
                  },
                  "colors": {},
                  "header": {
                    "fontSize": "md"
                  },
                  "width": {
                    "auto": true,
                    "min": 125,
                    "value": 100
                  },
                  "wrap": true
                },
                "columnTooltip": "",
                "edit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false,
                  "permission": {
                    "mode": "",
                    "userRole": []
                  }
                },
                "enabled": true,
                "field": {
                  "name": "target_pcp",
                  "source": "A"
                },
                "fileCell": {
                  "size": "md",
                  "text": "Download",
                  "variant": "primary"
                },
                "filter": {
                  "enabled": false,
                  "mode": "client",
                  "variable": ""
                },
                "footer": [],
                "gauge": {
                  "mode": "basic",
                  "valueDisplayMode": "text",
                  "valueSize": 14
                },
                "group": false,
                "label": "",
                "newRowEdit": {
                  "editor": {
                    "type": "string"
                  },
                  "enabled": false
                },
                "objectId": "",
                "pin": "",
                "preformattedStyle": false,
                "scale": "auto",
                "showingRows": 20,
                "sort": {
                  "descFirst": false,
                  "enabled": true
                },
                "type": "rich_text"
              }
            ],
            "name": "Table",
            "pagination": {
              "defaultPageSize": 10,
              "enabled": false,
              "mode": "client"
            },
            "rowHighlight": {
              "backgroundColor": "transparent",
              "columnId": "",
              "enabled": false,
              "scrollTo": "",
              "smooth": false,
              "variable": ""
            },
            "showHeader": true,
            "update": {
              "datasource": "",
              "payload": {}
            }
          }
        ],
        "toolbar": {
          "alignment": "left"
        }
      },
      "pluginVersion": "2.6.0",
      "targets": [
        {
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "with acquisition_vectors as (\n    select *\n    from derived.get_systems_with_power_and_state('Nakato Kaine', array ['Fortified', 'Stronghold'])\n), unoccupied_systems as (\n    select *\n    from core.systems\n    where 'Nakato Kaine' = any(powers)\n    and power_state = 'Unoccupied'\n), all_acquisition_routes as (\n\tselect\n\t\tav.name as acquisition_vector,\n\t\tav.id as acquisition_vector_id,\n\t\tav.power_state as vector_state,\n\t\tus.name as acquisition_target,\n\t\tus.id as acquisition_target_id,\n\t\tus.power_state as target_state,\n\t\tus.population as target_population,\n\t\tus.body_count as target_body_count,\n\t\tus.primary_economy as target_primary_economy,\n\t\tus.power_conflict_progress as target_pcp,\n\t\tus.controlling_faction_id,\n\t\tst_3ddistance(av.coords, us.coords) as distance\n\tfrom acquisition_vectors as av\n\tjoin unoccupied_systems as us on st_3ddwithin(\n\t\tav.coords, \n\t\tus.coords, \n\t\tcase when av.power_state = 'Stronghold' then 30 else 20 end\n\t)\n), acquisition_routes_with_hotspots as (\n\tselect *\n\tfrom all_acquisition_routes aar\n\tjoin derived.hotspot_ring_view hrv on hrv.system_name = aar.acquisition_vector\n\twhere hrv.commodity in ('Monazite', 'Platinum')\n), acquisition_routes_with_hotspots_and_markets as (\n\tselect *\n\tfrom acquisition_routes_with_hotspots arh\n\tjoin derived.station_commodities_view scv on arh.acquisition_target = scv.system_name\n\twhere arh.commodity = scv.commodity_sym\n\tand scv.updated_at > (NOW() - interval '2 days')\n), ranked_stations AS (\n  SELECT\n    *,\n    ROW_NUMBER() OVER (\n      PARTITION BY acquisition_vector, acquisition_target, commodity\n      ORDER BY sell_price DESC NULLS LAST\n    ) AS station_rank\n  FROM acquisition_routes_with_hotspots_and_markets\n), top_station_rows AS (\n  SELECT *\n  FROM ranked_stations\n  WHERE station_rank <= 1\n)\nSELECT\n  concat(tsr.acquisition_vector, ' (', tsr.vector_state, ')') as vector_system,\n  tsr.acquisition_target as target_unoccupied_system,\n  array_agg(tsr.commodity) as mineables,\n  concat(round(min(tsr.distance)::numeric, 2), ' LY') AS distance,\n\ttsr.target_population,\n\ttsr.target_body_count,\n\tfp.state as target_controlling_faction_state,\n\ttsr.target_primary_economy,\n\t(\n\t\tSELECT\n  \t\tstring_agg(power || ' (' || ROUND(progress::numeric * 100, 1) || '%)', '<br>') AS powers_inline\n\t\tFROM jsonb_to_recordset(tsr.target_pcp::jsonb)\n  \t\tAS x(power TEXT, progress FLOAT)\n\t) as target_pcp\nFROM top_station_rows tsr\njoin core.faction_presences fp on tsr.controlling_faction_id = fp.faction_id and tsr.acquisition_target_id = fp.system_id\nGROUP BY\n  tsr.acquisition_vector, tsr.vector_state, tsr.acquisition_target,\n\ttsr.target_population, tsr.target_body_count, tsr.target_primary_economy, tsr.target_pcp,\n\tfp.state\nORDER BY tsr.acquisition_vector, tsr.acquisition_target;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Kaine Mining Acquisition Routes (Summarized)",
      "type": "volkovlabs-table-panel"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "eemqg1029gbnka"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "distance"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 89
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "ring_names"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 301
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "sell_price"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 91
              },
              {
                "id": "unit",
                "value": "locale"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "station_name"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 222
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "demand"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 77
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "target_system"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 186
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "ring_types"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 113
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "commodity"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 94
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 16
      },
      "id": 6,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": [
          {
            "desc": false,
            "displayName": "vector_system"
          }
        ]
      },
      "pluginVersion": "12.0.1",
      "targets": [
        {
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "with acquisition_vectors as (\n    select *\n    from derived.get_systems_with_power_and_state('Nakato Kaine', array ['Fortified', 'Stronghold'])\n), unoccupied_systems as (\n    select *\n    from core.systems\n    where 'Nakato Kaine' = any(powers)\n    and power_state = 'Unoccupied'\n), all_acquisition_routes as (\n\tselect\n\t\tav.name as acquisition_vector,\n\t\tav.id as acquisition_vector_id,\n\t\tav.power_state as vector_state,\n\t\tus.name as acquisition_target,\n\t\tus.id as acquisition_target_id,\n\t\tus.power_state as target_state,\n\t\tst_3ddistance(av.coords, us.coords) as distance\n\tfrom acquisition_vectors as av\n\tjoin unoccupied_systems as us on st_3ddwithin(\n\t\tav.coords, \n\t\tus.coords, \n\t\tcase when av.power_state = 'Stronghold' then 30 else 20 end\n\t)\n), acquisition_routes_with_hotspots as (\n\tselect *\n\tfrom all_acquisition_routes aar\n\tjoin derived.hotspot_ring_view hrv on hrv.system_name = aar.acquisition_vector\n\twhere hrv.commodity in ('Monazite', 'Platinum')\n), acquisition_routes_with_hotspots_and_markets as (\n\tselect *\n\tfrom acquisition_routes_with_hotspots arh\n\tjoin derived.station_commodities_view scv on arh.acquisition_target = scv.system_name\n\twhere arh.commodity = scv.commodity_sym\n\tand scv.updated_at > (NOW() - interval '3 days')\n), ranked_stations AS (\n  SELECT\n    *,\n    ROW_NUMBER() OVER (\n      PARTITION BY acquisition_vector, acquisition_target, commodity\n      ORDER BY sell_price DESC NULLS LAST\n    ) AS station_rank\n  FROM acquisition_routes_with_hotspots_and_markets\n), top_station_rows AS (\n  SELECT *\n  FROM ranked_stations\n  WHERE station_rank <= 1\n)\nSELECT\n  concat(acquisition_vector, ' (', vector_state, ')') as vector_system,\n  acquisition_target as target_system,\n  concat(round(min(distance)::numeric, 2), ' LY') AS distance,\n  array_agg(DISTINCT ring_name) AS ring_names,\n  array_agg(DISTINCT ring_type) AS ring_types,\n  commodity,\n  station_name, sell_price, demand, updated_at\nFROM top_station_rows\nGROUP BY\n  acquisition_vector, vector_state, acquisition_target, commodity, station_name, sell_price, demand, updated_at\nORDER BY acquisition_vector, acquisition_target;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Kaine Mining Acquisition Routes",
      "type": "table"
    },
    {
      "datasource": {
        "uid": "eemqg1029gbnka"
      },
      "description": "Lists any Kaine-influenced AS/RS that were detected as having entered a Boom state in the last 72 hours from a non-Boom state.\n\nDetection relies on a transition into Boom state via EDDN messages rather than directly checking the current known state of factions",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "name"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 201
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "active_states"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 239
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "detected_boom_at"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 174
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "states_updated_at"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 174
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "state"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 82
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "population"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 103
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "power_state"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 103
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "faction_name"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 265
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 4,
        "w": 24,
        "x": 0,
        "y": 24
      },
      "id": 4,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true,
        "sortBy": []
      },
      "pluginVersion": "12.0.1",
      "targets": [
        {
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "\nWITH ranked_state_changes AS (\n  SELECT\n    LAG(fp.state) OVER (PARTITION BY fp.faction_id, fp.system_id ORDER BY fp.timestamp) AS previous_state,\n    fp.*\n  FROM timescaledb.faction_presences fp\n  WHERE fp.timestamp > NOW() - INTERVAL '3 days'\n),\nlatest_boom_transitions AS (\n  SELECT *\n  FROM (\n    SELECT *,\n           ROW_NUMBER() OVER (PARTITION BY system_id ORDER BY timestamp DESC) AS rn\n    FROM ranked_state_changes\n    WHERE state = 'Boom' AND previous_state <> 'Boom'\n  ) t\n  WHERE rn = 1\n)\nSELECT\n  s.name AS system_name,\n  f.name AS faction_name,\n  s.power_state,\n  s.population,\n  fp.state,\n  fp.active_states,\n  fp.pending_states,\n  fp.updated_at AS states_updated_at,\n  sc.timestamp AS detected_boom_at,\n  (NOW() - sc.timestamp) AS time_in_boom\nFROM latest_boom_transitions sc\nJOIN core.systems s ON s.id = sc.system_id\nJOIN core.faction_presences fp ON fp.system_id = s.id AND fp.faction_id = s.controlling_faction_id\nJOIN core.factions f ON f.id = s.controlling_faction_id\nWHERE fp.state = 'Boom'\n  AND (\n    s.controlling_power = 'Nakato Kaine'\n    OR ('Nakato Kaine' = ANY(s.powers) AND s.power_state = 'Unoccupied')\n)\nORDER BY system_name;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Kaine AS/RS Detected Entering Boom Last 3 Days",
      "type": "table"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "eemqg1029gbnka"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green"
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 13,
        "w": 17,
        "x": 0,
        "y": 28
      },
      "id": 1,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "12.0.1",
      "targets": [
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "eemqg1029gbnka"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "select s.name, s.power_state, fp.state, fp.updated_at\nfrom core.systems s\njoin core.faction_presences fp \non s.id = fp.system_id\nand s.controlling_faction_id = fp.faction_id\nwhere 'Boom' = fp.state\nand (now() - fp.updated_at) < interval '2 days'\nand (s.controlling_power = 'Nakato Kaine' or ('Nakato Kaine' = any(s.powers) and s.power_state = 'Unoccupied'))\norder by s.name\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Kaine AS/RS Systems Currently In Boom",
      "type": "table"
    }
  ],
  "preload": false,
  "schemaVersion": 41,
  "tags": [],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "Global Dashboard",
  "uid": "9f40134c-084d-4b71-8490-a3d927e35053",
  "version": 28
}